!function(e){var t={};function i(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){"use strict";var o,s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.RED="red",e.BLACK="black"}(o||(o={})),t.CampType=o,function(e){e.BING="兵",e.ZU="卒",e.JIANG="將",e.SHUAI="帥",e.JU="車",e.PAO="炮",e.RSHI="仕",e.BSHI="士",e.RXIANG="相",e.BXIANG="象",e.MA="馬"}(s||(s={})),t.PieceType=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(2);window.Chess=o.Chess},function(e,t,i){"use strict";var o=this&&this.__assign||Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e};Object.defineProperty(t,"__esModule",{value:!0}),i(3);var s=i(0),n=i(4),r=i(5),a=i(6),c=function(){function e(e,t){if(this.lastSelectedPiece=null,!e||"canvas"!=e.tagName.toLowerCase())throw new Error("请在构造函数中传入HTMLCanvasElement对象！");this.initDefaults(),this.canvas=e,this.options=o({},this.defaults,t),this.board=new n.Board(this.options),this.initCanvas(),this.initPieces(),this.listener(),this.invalidate(),this.rule=new a.Rule(this._pieces,this.board)}return e.prototype.initDefaults=function(){this.defaults={width:540,height:600,padding:40}},e.prototype.initCanvas=function(){var e=this.options,t=e.width,i=e.height;e.padding;this.canvas.width=t,this.canvas.height=i,this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.canvas.style.border="1px solid #ddd"},Object.defineProperty(e.prototype,"pieces",{get:function(){return this._pieces.filter(function(e){return!e.die})},enumerable:!0,configurable:!0}),e.prototype.initPieces=function(){var e=this.board.cellSize;this._pieces=[new r.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:0},!0),new r.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:2},!0),new r.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:4},!0),new r.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:6},!0),new r.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:8},!0),new r.Piece(s.CampType.RED,s.PieceType.PAO,e,{row:7,col:1},!0),new r.Piece(s.CampType.RED,s.PieceType.PAO,e,{row:7,col:7},!0),new r.Piece(s.CampType.RED,s.PieceType.JU,e,{row:9,col:0},!0),new r.Piece(s.CampType.RED,s.PieceType.JU,e,{row:9,col:8},!0),new r.Piece(s.CampType.RED,s.PieceType.MA,e,{row:9,col:1},!0),new r.Piece(s.CampType.RED,s.PieceType.MA,e,{row:9,col:7},!0),new r.Piece(s.CampType.RED,s.PieceType.RXIANG,e,{row:9,col:2},!0),new r.Piece(s.CampType.RED,s.PieceType.RXIANG,e,{row:9,col:6},!0),new r.Piece(s.CampType.RED,s.PieceType.RSHI,e,{row:9,col:3},!0),new r.Piece(s.CampType.RED,s.PieceType.RSHI,e,{row:9,col:5},!0),new r.Piece(s.CampType.RED,s.PieceType.SHUAI,e,{row:9,col:4},!0),new r.Piece(s.CampType.BLACK,s.PieceType.JIANG,e,{row:0,col:4}),new r.Piece(s.CampType.BLACK,s.PieceType.JU,e,{row:0,col:0}),new r.Piece(s.CampType.BLACK,s.PieceType.MA,e,{row:0,col:1})]},e.prototype.putPiece=function(e){for(var t=0,i=this.pieces;t<i.length;t++){var o=i[t],s=this.board.pos2point(o.pos.row,o.pos.col),n=.5*o.size;e.drawImage(o.canvas,s.x-n,s.y-n)}},e.prototype.listener=function(){var e=this;this.canvas.addEventListener("mousemove",function(t){var i=t.offsetX,o=t.offsetY;e.rule.pointInPieces({x:i,y:o})?e.canvas.style.cursor="pointer":e.canvas.style.cursor=""}),this.canvas.addEventListener("mousedown",function(t){var i={x:t.offsetX,y:t.offsetY},o=e.rule.pointInPieces(i);if(o)e.lastSelectedPiece&&(e.lastSelectedPiece.selected=!1),o.selected=!0,e.lastSelectedPiece=o,e.invalidate();else{var s=e.board.point2pos(i);if(s&&e.lastSelectedPiece){var n=e.rule.checkPieceMove(e.lastSelectedPiece,s);if(!n){var a=new Error("不能移动到该位置！");throw e._onerror instanceof Function&&e._onerror(a),a}n instanceof r.Piece&&(n.die=!0),e.lastSelectedPiece.pos=s,e.invalidate()}}})},e.prototype.onError=function(e){this._onerror=e},e.prototype.invalidate=function(){var e=this.canvas.getContext("2d"),t=this.options,i=t.width,o=t.height;e.clearRect(0,0,i,o),e.drawImage(this.board.canvas,0,0),this.putPiece(this.canvas.getContext("2d"))},e.COL_COUNT=9,e.ROW_COUNT=10,e}();t.Chess=c},function(e,t,i){"use strict";CanvasRenderingContext2D.prototype.drawLine=function(e,t){this.moveTo(e.x,e.y),this.lineTo(t.x,t.y)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t){this._canvas=document.createElement("canvas");var i=t.width,o=t.height,s=t.padding;this._canvas.width=i,this._canvas.height=o,this._cellSize=Math.min((i-2*s)/(e.COL_COUNT-1),(o-2*s)/(e.ROW_COUNT-1)),this.boardStartPoint={x:.5*(i-8*this._cellSize),y:.5*(o-9*this._cellSize)},this.draw()}return e.prototype.draw=function(){var t=this,i=this.cellSize,o=this.boardStartPoint,s=this._canvas.getContext("2d");s.beginPath();for(var n=o.x,r=this.pos2point(0,8).x,a=o.y,c=0;c<e.ROW_COUNT;c++)s.moveTo(n,a),s.lineTo(r,a),a+=i;for(var p=o.y,h=this.pos2point(4,0).y,l=this.pos2point(5,0).y,y=this.pos2point(9,0).y,u=o.x,f=0;f<e.COL_COUNT;f++)0==f||f==e.COL_COUNT-1?(s.moveTo(u,p),s.lineTo(u,y)):(s.moveTo(u,p),s.lineTo(u,h),s.moveTo(u,l),s.lineTo(u,y)),u+=i;s.drawLine(this.pos2point(0,3),this.pos2point(2,5)),s.drawLine(this.pos2point(2,3),this.pos2point(0,5)),s.drawLine(this.pos2point(7,3),this.pos2point(9,5)),s.drawLine(this.pos2point(9,3),this.pos2point(7,5)),s.stroke();var d=function(e){var i=t.cellSize/5;if(s.beginPath(),s.save(),s.lineWidth=2,e.x!=t.boardStartPoint.x){var o={x:e.x-5,y:e.y-5};s.drawLine(o,{x:o.x,y:o.y-i}),s.drawLine(o,{x:o.x-i,y:o.y});var n={x:e.x-5,y:e.y+5};s.drawLine(n,{x:n.x,y:n.y+i}),s.drawLine(n,{x:n.x-i,y:n.y})}if(e.x!=t.pos2point(0,8).x){var r={x:e.x+5,y:e.y-5};s.drawLine(r,{x:r.x,y:r.y-i}),s.drawLine(r,{x:r.x+i,y:r.y});var a={x:e.x+5,y:e.y+5};s.drawLine(a,{x:a.x,y:a.y+i}),s.drawLine(a,{x:a.x+i,y:a.y})}s.stroke(),s.restore()};d(this.pos2point(2,1)),d(this.pos2point(2,7)),d(this.pos2point(7,1)),d(this.pos2point(7,7)),d(this.pos2point(3,0)),d(this.pos2point(3,2)),d(this.pos2point(3,4)),d(this.pos2point(3,6)),d(this.pos2point(3,8)),d(this.pos2point(6,0)),d(this.pos2point(6,2)),d(this.pos2point(6,4)),d(this.pos2point(6,6)),d(this.pos2point(6,8)),s.beginPath(),s.lineWidth=3;u=o.x-5,a=o.y-5;var w=this.pos2point(0,8).x+5-u,v=this.pos2point(9,0).y+5-a;s.rect(u,a,w,v),s.stroke()},e.prototype.pos2point=function(e,t){var i=this.boardStartPoint,o=i.x,s=i.y;return{x:o+t*this.cellSize,y:s+e*this.cellSize}},e.prototype.point2pos=function(t){for(var i=.3*this.cellSize,o=0;o<e.ROW_COUNT;o++)for(var s=0;s<e.COL_COUNT;s++){var n=this.pos2point(o,s),r=n.x,a=n.y;if(t.x>r-i&&t.x<r+i&&t.y>a-i&&t.y<a+i)return{row:o,col:s}}return null},Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellSize",{get:function(){return this._cellSize},enumerable:!0,configurable:!0}),e.COL_COUNT=9,e.ROW_COUNT=10,e}();t.Board=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,i,o,s){void 0===s&&(s=!1),this._die=!1,this._selected=!1,this._self=!1,this._campType=e,this._pieceType=t,this._size=i,this._canvas=document.createElement("canvas"),this._pos=o,this._self=s,this.draw()}return e.prototype.draw=function(){this._canvas.width=this._canvas.height=this._size;var e=this._canvas.getContext("2d");e.clearRect(0,0,this._size,this._size),e.strokeStyle="#666",e.beginPath(),e.save(),e.shadowBlur=5,e.shadowColor="#666",e.shadowOffsetX=1,e.shadowOffsetY=1;var t=.5*this._size;e.arc(t,t,t-4,0,2*Math.PI,!1),e.fillStyle="#F3AD84",e.fill(),e.arc(t,t,t-7,0,2*Math.PI,!0),e.fill(),e.restore(),e.beginPath(),e.fillStyle=this._campType;var i=.45*this._size;if(e.font=i+"px 微软雅黑",e.textAlign="center",e.textBaseline="middle",e.fillText(this._pieceType,t,t-2),this.selected){e.strokeStyle="brown",e.lineWidth=6;e.drawLine({x:0,y:0},{x:10,y:0}),e.drawLine({x:0,y:0},{x:0,y:10}),e.drawLine({x:this._size,y:0},{x:this._size-10,y:0}),e.drawLine({x:this._size,y:0},{x:this._size,y:10}),e.drawLine({x:0,y:this._size},{x:0,y:this._size-10}),e.drawLine({x:0,y:this._size},{x:10,y:this._size}),e.drawLine({x:this._size,y:this._size},{x:this._size,y:this._size-10}),e.drawLine({x:this._size,y:this._size},{x:this._size-10,y:this._size}),e.stroke()}},Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos},set:function(e){this._pos=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pieceType",{get:function(){return this._pieceType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"campType",{get:function(){return this._campType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"self",{get:function(){return this._self},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"die",{get:function(){return this._die},set:function(e){this._die=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,this.draw()},enumerable:!0,configurable:!0}),e}();t.Piece=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(){function e(e,t){this.board=t,this._pieces=e}return Object.defineProperty(e.prototype,"pieces",{get:function(){return this._pieces.filter(function(e){return!e.die})},enumerable:!0,configurable:!0}),e.prototype.pointInPieces=function(e){for(var t=0,i=this.pieces;t<i.length;t++){var o=i[t];if(o.self){var s=this.board.pos2point(o.pos.row,o.pos.col),n=s.x,r=s.y,a=.5*o.size;if(e.x>n-a&&e.x<n+a&&e.y>r-a&&e.y<r+a)return o}}return null},e.prototype.pieceDistancePos=function(e,t){var i=e.pos,o=i.row,s=i.col;if(o==t.row){for(var n=[],r=s>t.col?t.col+1:s+1,a=s>t.col?s:t.col,c=r;c<a;c++)n.push({row:o,col:c});return this.pieces.filter(function(e){for(var t=0,i=n;t<i.length;t++){var o=i[t];if(e.pos.row==o.row&&e.pos.col==o.col)return!0}return!1}).length}if(s==t.col){var p=[];for(r=o>t.row?t.row+1:o+1,a=o>t.row?o:t.row,c=r;c<a;c++)p.push({col:s,row:c});return this.pieces.filter(function(e){for(var t=0,i=p;t<i.length;t++){var o=i[t];if(e.pos.row==o.row&&e.pos.col==o.col)return!0}return!1}).length}return-1},e.prototype.checkPieceMove=function(e,t){var i=e.pos,s=i.row,n=i.col,r=this.pieces.find(function(e){return e.pos.col==t.col&&e.pos.row==t.row});if(r&&r.campType==e.campType)return!1;var a=!1,c=this.pieceDistancePos(e,t),p=t.row-s,h=t.col-n;switch(e.pieceType){case o.PieceType.JU:0==c&&(a=!0);break;case o.PieceType.PAO:(r&&1==c||!r&&0==c)&&(a=!0);break;case o.PieceType.MA:if(1==Math.abs(p)&&2==Math.abs(h)||2==Math.abs(p)&&1==Math.abs(h)){var l=s,y=n;Math.abs(p)>Math.abs(h)?l+=p>0?1:-1:y+=h>0?1:-1,this.pieces.find(function(e){return e.pos.row==l&&e.pos.col==y})||(a=!0)}break;case o.PieceType.BXIANG:case o.PieceType.RXIANG:if(e.self&&t.row<5||!e.self&&t.row>4)break;if(2==Math.abs(p)&&2==Math.abs(h)){var u=s+(p>0?1:-1),f=n+(h>0?1:-1);this.pieces.find(function(e){return e.pos.row==u&&e.pos.col==f})||(a=!0)}break;case o.PieceType.RSHI:case o.PieceType.BSHI:if(t.col<3||t.col>5||e.self&&t.row<7||!e.self&&t.row>2)break;1==Math.abs(p)&&1==Math.abs(h)&&(a=!0);break;case o.PieceType.BING:case o.PieceType.ZU:if(!(1==Math.abs(p)&&0==Math.abs(h)||0==Math.abs(p)&&1==Math.abs(h)))break;e.self&&p<=0?(Math.abs(h)>0&&e.pos.row<=4||p<0)&&(a=!0):!e.self&&p>=0&&(Math.abs(h)>0&&e.pos.row>=5||p>0)&&(a=!0);break;case o.PieceType.JIANG:case o.PieceType.SHUAI:if(t.col<3||t.col>5||e.self&&t.row<7||!e.self&&t.row>2)break;(1==Math.abs(p)&&0==Math.abs(h)||0==Math.abs(p)&&1==Math.abs(h))&&(a=!0)}return a&&r||a},e}();t.Rule=s}]);
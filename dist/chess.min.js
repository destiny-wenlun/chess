!function(e){var t={};function i(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=1)}([function(e,t,i){"use strict";var o,s;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.RED="red",e.BLACK="black"}(o||(o={})),t.CampType=o,function(e){e.BING="兵",e.ZU="卒",e.JIANG="將",e.SHUAI="帥",e.JU="車",e.PAO="炮",e.RSHI="仕",e.BSHI="士",e.RXIANG="相",e.BXIANG="象",e.MA="馬"}(s||(s={})),t.PieceType=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(2);window.Chess=o.Chess},function(e,t,i){"use strict";var o=this&&this.__assign||Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e};Object.defineProperty(t,"__esModule",{value:!0}),i(3);var s=i(0),r=i(4),n=i(5),c=i(6),a=i(7),p=function(){function e(e,t){if(this.active=!0,this.lastSelectedPiece=null,this.enemyLastSelectedPiece=null,!e||"canvas"!=e.tagName.toLowerCase())throw new Error("请在构造函数中传入HTMLCanvasElement对象！");this.initDefaults(),this.canvas=e,this.options=o({},this.defaults,t),this.board=new r.Board(this.options),this.initCanvas(),this.initPieces(),this.listener(),this.invalidate(),this.rule=new c.Rule(this._pieces,this.board),this.ai=new a.Ai(this._pieces)}return e.prototype.initDefaults=function(){this.defaults={width:540,height:600,padding:40}},e.prototype.initCanvas=function(){var e=this.options,t=e.width,i=e.height;e.padding;this.canvas.width=t,this.canvas.height=i,this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.canvas.style.border="1px solid #ddd"},Object.defineProperty(e.prototype,"pieces",{get:function(){return this._pieces.filter(function(e){return!e.die})},enumerable:!0,configurable:!0}),e.prototype.initPieces=function(){var e=this.board.cellSize;this._pieces=[new n.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:0},!0),new n.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:2},!0),new n.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:4},!0),new n.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:6},!0),new n.Piece(s.CampType.RED,s.PieceType.BING,e,{row:6,col:8},!0),new n.Piece(s.CampType.RED,s.PieceType.PAO,e,{row:7,col:1},!0),new n.Piece(s.CampType.RED,s.PieceType.PAO,e,{row:7,col:7},!0),new n.Piece(s.CampType.RED,s.PieceType.JU,e,{row:9,col:0},!0),new n.Piece(s.CampType.RED,s.PieceType.JU,e,{row:9,col:8},!0),new n.Piece(s.CampType.RED,s.PieceType.MA,e,{row:9,col:1},!0),new n.Piece(s.CampType.RED,s.PieceType.MA,e,{row:9,col:7},!0),new n.Piece(s.CampType.RED,s.PieceType.RXIANG,e,{row:9,col:2},!0),new n.Piece(s.CampType.RED,s.PieceType.RXIANG,e,{row:9,col:6},!0),new n.Piece(s.CampType.RED,s.PieceType.RSHI,e,{row:9,col:3},!0),new n.Piece(s.CampType.RED,s.PieceType.RSHI,e,{row:9,col:5},!0),new n.Piece(s.CampType.RED,s.PieceType.SHUAI,e,{row:9,col:4},!0),new n.Piece(s.CampType.BLACK,s.PieceType.ZU,e,{row:3,col:0}),new n.Piece(s.CampType.BLACK,s.PieceType.ZU,e,{row:3,col:2}),new n.Piece(s.CampType.BLACK,s.PieceType.ZU,e,{row:3,col:4}),new n.Piece(s.CampType.BLACK,s.PieceType.ZU,e,{row:3,col:6}),new n.Piece(s.CampType.BLACK,s.PieceType.ZU,e,{row:3,col:8}),new n.Piece(s.CampType.BLACK,s.PieceType.PAO,e,{row:2,col:1}),new n.Piece(s.CampType.BLACK,s.PieceType.PAO,e,{row:2,col:7}),new n.Piece(s.CampType.BLACK,s.PieceType.JU,e,{row:0,col:0}),new n.Piece(s.CampType.BLACK,s.PieceType.JU,e,{row:0,col:8}),new n.Piece(s.CampType.BLACK,s.PieceType.MA,e,{row:0,col:1}),new n.Piece(s.CampType.BLACK,s.PieceType.MA,e,{row:0,col:7}),new n.Piece(s.CampType.BLACK,s.PieceType.BXIANG,e,{row:0,col:2}),new n.Piece(s.CampType.BLACK,s.PieceType.BXIANG,e,{row:0,col:6}),new n.Piece(s.CampType.BLACK,s.PieceType.BSHI,e,{row:0,col:3}),new n.Piece(s.CampType.BLACK,s.PieceType.BSHI,e,{row:0,col:5}),new n.Piece(s.CampType.BLACK,s.PieceType.JIANG,e,{row:0,col:4})]},e.prototype.putPiece=function(e){for(var t=0,i=this.pieces;t<i.length;t++){var o=i[t],s=this.board.pos2point(o.pos.row,o.pos.col),r=.5*o.size;e.drawImage(o.canvas,s.x-r,s.y-r)}},e.prototype.switch=function(){if(this.active){this.active=!1;var e=this.ai.generate(),t=e.piece,i=e.pos,o=e.eatPiece;this.board.markPos(t.pos),t.selected=!0,t.pos=i,this.enemyLastSelectedPiece=t,o&&(o.die=!0),this.invalidate(),this.switch()}else this.active=!0},e.prototype.listener=function(){var e=this;this.canvas.addEventListener("mousemove",function(t){var i=t.offsetX,o=t.offsetY;e.active&&e.rule.pointInPieces({x:i,y:o})?e.canvas.style.cursor="pointer":e.canvas.style.cursor=""}),this.canvas.addEventListener("mousedown",function(t){var i=t.offsetX,o=t.offsetY;if(e.active){var s={x:i,y:o},r=e.rule.pointInPieces(s);if(r)e.lastSelectedPiece&&(e.lastSelectedPiece.selected=!1),e.enemyLastSelectedPiece&&(e.enemyLastSelectedPiece.selected=!1),r.selected=!0,e.lastSelectedPiece=r,e.board.markPos(),e.invalidate();else{var c=e.board.point2pos(s);if(c&&e.lastSelectedPiece){var a=e.rule.checkPieceMove(e.lastSelectedPiece,c);if(!a){var p=new Error("不能移动到该位置！");throw e._onerror instanceof Function&&e._onerror(p),p}a instanceof n.Piece&&(a.die=!0),e.lastSelectedPiece.pos=c,e.lastSelectedPiece.selected=!1,e.lastSelectedPiece=null,e.switch(),e.invalidate()}}}})},e.prototype.onError=function(e){this._onerror=e},e.prototype.invalidate=function(){var e=this.canvas.getContext("2d"),t=this.options,i=t.width,o=t.height;e.clearRect(0,0,i,o),e.drawImage(this.board.canvas,0,0),this.putPiece(this.canvas.getContext("2d"))},e.COL_COUNT=9,e.ROW_COUNT=10,e}();t.Chess=p},function(e,t,i){"use strict";CanvasRenderingContext2D.prototype.drawLine=function(e,t){this.moveTo(e.x,e.y),this.lineTo(t.x,t.y)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t){this.board=document.createElement("canvas"),this._canvas=document.createElement("canvas");var i=t.width,o=t.height,s=t.padding;this.options=t,this._canvas.width=i,this._canvas.height=o,this.board.width=i,this.board.height=o,this._cellSize=Math.min((i-2*s)/(e.COL_COUNT-1),(o-2*s)/(e.ROW_COUNT-1)),this.boardStartPoint={x:.5*(i-8*this._cellSize),y:.5*(o-9*this._cellSize)},this.mark=document.createElement("canvas"),this.mark.width=this._cellSize,this.mark.height=this._cellSize,this.drawBoard(),this.drawMark(),this.markPos()}return e.prototype.drawBoard=function(){var t=this,i=this.cellSize,o=this.boardStartPoint,s=this.board.getContext("2d");s.beginPath();for(var r=o.x,n=this.pos2point(0,8).x,c=o.y,a=0;a<e.ROW_COUNT;a++)s.moveTo(r,c),s.lineTo(n,c),c+=i;for(var p=o.y,l=this.pos2point(4,0).y,h=this.pos2point(5,0).y,y=this.pos2point(9,0).y,u=o.x,f=0;f<e.COL_COUNT;f++)0==f||f==e.COL_COUNT-1?(s.moveTo(u,p),s.lineTo(u,y)):(s.moveTo(u,p),s.lineTo(u,l),s.moveTo(u,h),s.lineTo(u,y)),u+=i;s.drawLine(this.pos2point(0,3),this.pos2point(2,5)),s.drawLine(this.pos2point(2,3),this.pos2point(0,5)),s.drawLine(this.pos2point(7,3),this.pos2point(9,5)),s.drawLine(this.pos2point(9,3),this.pos2point(7,5)),s.stroke();var d=function(e){var i=t.cellSize/5;if(s.beginPath(),s.save(),s.lineWidth=2,e.x!=t.boardStartPoint.x){var o={x:e.x-5,y:e.y-5};s.drawLine(o,{x:o.x,y:o.y-i}),s.drawLine(o,{x:o.x-i,y:o.y});var r={x:e.x-5,y:e.y+5};s.drawLine(r,{x:r.x,y:r.y+i}),s.drawLine(r,{x:r.x-i,y:r.y})}if(e.x!=t.pos2point(0,8).x){var n={x:e.x+5,y:e.y-5};s.drawLine(n,{x:n.x,y:n.y-i}),s.drawLine(n,{x:n.x+i,y:n.y});var c={x:e.x+5,y:e.y+5};s.drawLine(c,{x:c.x,y:c.y+i}),s.drawLine(c,{x:c.x+i,y:c.y})}s.stroke(),s.restore()};d(this.pos2point(2,1)),d(this.pos2point(2,7)),d(this.pos2point(7,1)),d(this.pos2point(7,7)),d(this.pos2point(3,0)),d(this.pos2point(3,2)),d(this.pos2point(3,4)),d(this.pos2point(3,6)),d(this.pos2point(3,8)),d(this.pos2point(6,0)),d(this.pos2point(6,2)),d(this.pos2point(6,4)),d(this.pos2point(6,6)),d(this.pos2point(6,8)),s.beginPath(),s.lineWidth=3;u=o.x-5,c=o.y-5;var w=this.pos2point(0,8).x+5-u,P=this.pos2point(9,0).y+5-c;s.rect(u,c,w,P),s.stroke()},e.prototype.drawMark=function(){var e=this.mark.getContext("2d");e.strokeStyle="#969696",e.lineWidth=6;e.drawLine({x:0,y:0},{x:10,y:0}),e.drawLine({x:0,y:0},{x:0,y:10}),e.drawLine({x:this.cellSize,y:0},{x:this.cellSize-10,y:0}),e.drawLine({x:this.cellSize,y:0},{x:this.cellSize,y:10}),e.drawLine({x:0,y:this.cellSize},{x:0,y:this.cellSize-10}),e.drawLine({x:0,y:this.cellSize},{x:10,y:this.cellSize}),e.drawLine({x:this.cellSize,y:this.cellSize},{x:this.cellSize,y:this.cellSize-10}),e.drawLine({x:this.cellSize,y:this.cellSize},{x:this.cellSize-10,y:this.cellSize}),e.stroke()},e.prototype.markPos=function(e){var t=this.canvas.getContext("2d"),i=this.options,o=i.width,s=i.height;if(t.clearRect(0,0,o,s),t.drawImage(this.board,0,0),e){var r=this.pos2point(e.row,e.col),n=.5*this.cellSize;t.drawImage(this.mark,r.x-n,r.y-n)}},e.prototype.pos2point=function(e,t){var i=this.boardStartPoint,o=i.x,s=i.y;return{x:o+t*this.cellSize,y:s+e*this.cellSize}},e.prototype.point2pos=function(t){for(var i=.3*this.cellSize,o=0;o<e.ROW_COUNT;o++)for(var s=0;s<e.COL_COUNT;s++){var r=this.pos2point(o,s),n=r.x,c=r.y;if(t.x>n-i&&t.x<n+i&&t.y>c-i&&t.y<c+i)return{row:o,col:s}}return null},Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellSize",{get:function(){return this._cellSize},enumerable:!0,configurable:!0}),e.COL_COUNT=9,e.ROW_COUNT=10,e}();t.Board=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,i,o,s){void 0===s&&(s=!1),this._die=!1,this._selected=!1,this._self=!1,this._campType=e,this._pieceType=t,this._size=i,this._canvas=document.createElement("canvas"),this._pos=o,this._self=s,this.draw()}return e.prototype.draw=function(){this._canvas.width=this._canvas.height=this._size;var e=this._canvas.getContext("2d");e.clearRect(0,0,this._size,this._size),e.strokeStyle="#666",e.beginPath(),e.save(),e.shadowBlur=5,e.shadowColor="#666",e.shadowOffsetX=1,e.shadowOffsetY=1;var t=.5*this._size;e.arc(t,t,t-4,0,2*Math.PI,!1),e.fillStyle="#F3AD84",e.fill(),e.arc(t,t,t-7,0,2*Math.PI,!0),e.fill(),e.restore(),e.beginPath(),e.fillStyle=this._campType;var i=.45*this._size;if(e.font=i+"px 微软雅黑",e.textAlign="center",e.textBaseline="middle",e.fillText(this._pieceType,t,t-2),this.selected){e.strokeStyle="brown",e.lineWidth=6;e.drawLine({x:0,y:0},{x:10,y:0}),e.drawLine({x:0,y:0},{x:0,y:10}),e.drawLine({x:this._size,y:0},{x:this._size-10,y:0}),e.drawLine({x:this._size,y:0},{x:this._size,y:10}),e.drawLine({x:0,y:this._size},{x:0,y:this._size-10}),e.drawLine({x:0,y:this._size},{x:10,y:this._size}),e.drawLine({x:this._size,y:this._size},{x:this._size,y:this._size-10}),e.drawLine({x:this._size,y:this._size},{x:this._size-10,y:this._size}),e.stroke()}},Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos},set:function(e){this._pos=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pieceType",{get:function(){return this._pieceType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"campType",{get:function(){return this._campType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"self",{get:function(){return this._self},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"die",{get:function(){return this._die},set:function(e){this._die=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected},set:function(e){this._selected=e,this.draw()},enumerable:!0,configurable:!0}),e}();t.Piece=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(){function e(e,t){this.board=t,this._pieces=e}return Object.defineProperty(e.prototype,"pieces",{get:function(){return this._pieces.filter(function(e){return!e.die})},enumerable:!0,configurable:!0}),e.prototype.pointInPieces=function(e){for(var t=0,i=this.pieces;t<i.length;t++){var o=i[t];if(o.self){var s=this.board.pos2point(o.pos.row,o.pos.col),r=s.x,n=s.y,c=.5*o.size;if(e.x>r-c&&e.x<r+c&&e.y>n-c&&e.y<n+c)return o}}return null},e.prototype.pieceDistancePos=function(e,t){var i=e.pos,o=i.row,s=i.col;if(o==t.row){for(var r=[],n=s>t.col?t.col+1:s+1,c=s>t.col?s:t.col,a=n;a<c;a++)r.push({row:o,col:a});return this.pieces.filter(function(e){for(var t=0,i=r;t<i.length;t++){var o=i[t];if(e.pos.row==o.row&&e.pos.col==o.col)return!0}return!1}).length}if(s==t.col){var p=[];for(n=o>t.row?t.row+1:o+1,c=o>t.row?o:t.row,a=n;a<c;a++)p.push({col:s,row:a});return this.pieces.filter(function(e){for(var t=0,i=p;t<i.length;t++){var o=i[t];if(e.pos.row==o.row&&e.pos.col==o.col)return!0}return!1}).length}return-1},e.prototype.checkPieceMove=function(e,t){var i=e.pos,s=i.row,r=i.col,n=this.pieces.find(function(e){return e.pos.col==t.col&&e.pos.row==t.row});if(n&&n.campType==e.campType)return!1;var c=!1,a=this.pieceDistancePos(e,t),p=t.row-s,l=t.col-r;switch(e.pieceType){case o.PieceType.JU:0==a&&(c=!0);break;case o.PieceType.PAO:(n&&1==a||!n&&0==a)&&(c=!0);break;case o.PieceType.MA:if(1==Math.abs(p)&&2==Math.abs(l)||2==Math.abs(p)&&1==Math.abs(l)){var h=s,y=r;Math.abs(p)>Math.abs(l)?h+=p>0?1:-1:y+=l>0?1:-1,this.pieces.find(function(e){return e.pos.row==h&&e.pos.col==y})||(c=!0)}break;case o.PieceType.BXIANG:case o.PieceType.RXIANG:if(e.self&&t.row<5||!e.self&&t.row>4)break;if(2==Math.abs(p)&&2==Math.abs(l)){var u=s+(p>0?1:-1),f=r+(l>0?1:-1);this.pieces.find(function(e){return e.pos.row==u&&e.pos.col==f})||(c=!0)}break;case o.PieceType.RSHI:case o.PieceType.BSHI:if(t.col<3||t.col>5||e.self&&t.row<7||!e.self&&t.row>2)break;1==Math.abs(p)&&1==Math.abs(l)&&(c=!0);break;case o.PieceType.BING:case o.PieceType.ZU:if(!(1==Math.abs(p)&&0==Math.abs(l)||0==Math.abs(p)&&1==Math.abs(l)))break;e.self&&p<=0?(Math.abs(l)>0&&e.pos.row<=4||p<0)&&(c=!0):!e.self&&p>=0&&(Math.abs(l)>0&&e.pos.row>=5||p>0)&&(c=!0);break;case o.PieceType.JIANG:case o.PieceType.SHUAI:if(t.col<3||t.col>5||e.self&&t.row<7||!e.self&&t.row>2)break;(1==Math.abs(p)&&0==Math.abs(l)||0==Math.abs(p)&&1==Math.abs(l))&&(c=!0)}return c&&n||c},e}();t.Rule=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(0),s=function(){function e(e){this._pieces=e}return Object.defineProperty(e.prototype,"pieces",{get:function(){return this._pieces.filter(function(e){return!e.die})},enumerable:!0,configurable:!0}),e.prototype.generate=function(){var e=this.pieces.find(function(e){return!e.self&&e.pieceType==o.PieceType.ZU}),t={row:e.pos.row+1,col:e.pos.col},i=this.pieces.find(function(e){return e.pos.row==t.row&&e.pos.col==t.col});return{piece:e,pos:t,eatPiece:i}},e}();t.Ai=s}]);